<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="sr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <title>Planinarski klub "Summit Explorers"</title>

    <!-- Bootstrap 4.5 CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!-- reference CSS file -->
    <link rel="stylesheet" th:href="@{/css/myStyle.css}">

    <!--Font Awesome ikonice!-->
    <link th:href="@{/fontAwesome/all.css}" rel="stylesheet">
    <!--load all styles -->
</head>
<body class="bodyKorisnikBackground">

<!-- Top Bar -->
<div th:replace="fragments/topBar :: topBar1(brojTelefonaKluba=${klub.brojTelefona}, emailKluba=${klub.email})"></div>
<!-- kraj Top Bara -->

<!-- Navigation bar fragment -->
<div th:replace="fragments/navBar :: navBar1"></div>
<!-- Navigation bar fragment END-->

<div class="container" style="background-color: #fff;">

    <div class="col-md-12" style="height: 2rem;">

    </div>
    <div class="col-md-12 text-center" style="margin-bottom: 1.8rem;">
        <h2>Prodavnica Planinarske Opreme</h2>
    </div>

    <div class="row mb-4 px-5 d-flex justify-content-center">
            <th:block th:each="vrstaProizvoda : ${listaVrsteProizvoda}">
                <a class="btn btn-outline-info mr-4 mb-3" style="border-radius: 100px; white-space: nowrap;" th:href="@{'/prodavnica/vrstaProizvoda/' + ${vrstaProizvoda.vrstaProizvodaId}}">[[${vrstaProizvoda.naziv}]]</a>
            </th:block>
    </div>

    <div class="d-flex justify-content-end align-items-center">
        <div class="form-group row col-md-4 justify-content-end">
                <div class="col-md-4 d-flex align-items-end pr-0">
                    <label>Poredjaj po:</label>
                </div>
                <div class="col-md-8 pl-0">
                    <select class="form-control" id="orderBySelect">
                        <option value="">Najrelevantnije</option>
                        <option value="ASC">Cena, Manja ka Većoj</option>
                        <option value="DESC">Cena, Veća ka Manjoj</option>
                    </select>
                </div>
        </div>
    </div>
    <div class="bottomLineWhite"></div>


        <section id="listaSvihProizvodaSection">
            <th:block th:if="${listaSvihProizvoda != null and !listaSvihProizvoda.isEmpty()}">
                <div class="row d-flex justify-content-center" th:id="listaProizvodaWrapper">
                    <div th:each="proizvod : ${listaSvihProizvoda}" class="card mr-2 mb-3" style="width: 16rem;"> <!-- PROIZVOD Card -->
                        <a th:href="@{/prodavnica/proizvod(proizvodId=${proizvod.proizvodId})}">
                            <img class="lazy card-img-top" style="height: 250px;" th:src="@{${proizvod.getThumbnailPhotoPath()}}" th:alt="${'Slika proizvoda: ' + proizvod.naziv}">
                        </a>
                        <div class="card-body text-center">
                            <div class="row">

                                <!-- Cena Proizvoda i popust ako ima -->
                                <div class="d-flex justify-content-center col-md-12 mb-3 mt-3">
                                    <th:block th:if="${proizvod.popust != 0}">
                                        <div style="position: relative; margin-right: 0.8rem;">
                                            <span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #e4ce21;">[[${proizvod.cena}]]&#8364;</span>
                                            <i class="fa fa-slash redSlash3"></i>
                                        </div>
                                    </th:block>
                                    <th:block th:if="${proizvod.popust == 0}">
                                        <span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #e4ce21;">[[${proizvod.cena}]]&#8364;</span>
                                    </th:block>
                                    <th:block th:if="${proizvod.popust != 0}">
                                        <div th:with="cenaSaPopustom = ${@proizvodServiceImpl.getCenaProizvodaSaPopustom(proizvod)}">
                                            <span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #1fcb36;">[[${cenaSaPopustom}]] &#8364;</span>
                                        </div>
                                    </th:block>
                                </div>
                                <!-- KRAJ Cena Proizvoda i popust ako ima -->



                                <div class="d-flex justify-content-center col-md-12">
                                    <a th:href="@{/prodavnica/proizvod(proizvodId=${proizvod.proizvodId})}" class="text-decoration-none linkTextProdavnicaProizvod">
                                        <div class="card-title nazivProizvodaFrontPage">[[${proizvod.naziv}]]</div>
                                    </a>
                                </div>

                                <!-- Ima na Stanju ili Nema na Stanju -->
                                <div class="d-flex justify-content-center col-md-12" th:with="naStanju = ${@proizvodServiceImpl.daLiImaNaStanju(proizvod)}">
                                    <th:block th:if="${naStanju}">
                                        <span class="font-weight-bolder" style="color: #1e7e34;"><i class="fas fa-check"></i> Na Stanju</span>
                                    </th:block>
                                    <th:block th:if="${!naStanju}">
                                        <span class="font-weight-bolder" style="color: red;"><i class="fas fa-times"></i> Trenutno Nema na Stanju</span>
                                    </th:block>
                                </div>
                                <!--KRAJ Ima na Stanju ili Nema na Stanju -->

                            </div>
                        </div><!--KRAJ card-body div-a -->
                    </div><!-- KRAJ PROIZVOD CARD-A -->
                </div>
            </th:block>


            <div class="col-md-12 text-center">
                <div class="button">
                    <button id="showMoreBtn">Prikaži više</button>
                </div>
            </div>

        </section>


<!--    <section th:replace="fragments/prikazProizvodaFront :: prikazProizvodaFrontPage1(listaProizvoda=${listaSvihProizvoda})"></section>-->

    <th:block th:if="${listaSvihProizvoda == null or listaSvihProizvoda.isEmpty()}">
        <h4>Trenutno nema nijednog proizvoda u prodavnici.</h4>
    </th:block>



</div>

<div class="container px-0">
    <!--/* Footer fragment */-->
    <div th:replace="fragments/footer :: footer2(brojTelefonaKluba=${klub.brojTelefona}, emailKluba=${klub.email})"></div>
    <!--/* Footer fragment END */-->
</div>



<!-- Script Source Files -->

<!-- jQuery -->
<script th:src="@{/js/jquery-3.5.1.min.js}"></script>
<!-- Popper JS -->
<script th:src="@{/js/popper.min.js}"></script>
<!-- Bootstrap 4.5 JS -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- Font Awesome -->
<script th:src="@{/js/all.js}"></script>
<!-- jQuery lazyload za "load more" button -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js" integrity="sha512-jNDtFf7qgU0eH/+Z42FG4fw3w7DM/9zbgNPe3wfJlCylVDTT3IgKW5r92Vy9IHa6U50vyMz5gRByIu4YIXFtaQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script type="text/javascript" th:inline="javascript">


    $(document).ready(function (){
        if($("#listaSvihProizvodaSection .d-flex .card:hidden").length == 0){
            document.getElementById('showMoreBtn').style.display = 'none';
        }
    });

    $("#showMoreBtn").click(function(){
        $("#listaSvihProizvodaSection .d-flex .card:hidden").slice(0,4).slideDown();
        if($("#listaSvihProizvodaSection .d-flex .card:hidden").length == 0) {
            $("#showMoreBtn").fadeOut("slow");
        }
    });

</script>

<script>
    $(function(){
        $("img.lazy").lazyload();
    });
</script>

<script type="text/javascript" th:inline="javascript">
    $("#orderBySelect").on('change', function (){
        let orderDir = $(this).val();

        $.ajax({
            type: 'GET',
            url: '/orderProductsByPrice/' + orderDir,
            success: function (result){
                let listaProizvodaOrdered = JSON.parse(result);
                let s = '';
                for(let i = 0; i < listaProizvodaOrdered.length; i++) {
                    /*popunjavanje proizvoda u wrapper*/
                    s += `<div class="card mr-2 mb-3" style="width: 16rem;">
                            `;
                    let linkKaDetaljuProizvoda = "/prodavnica/proizvod?proizvodId=" + listaProizvodaOrdered[i].proizvodId;
                    let thumbnailPhotoPath = "/slikeProizvodi/proizvodId-" + listaProizvodaOrdered[i].proizvodId + "/" + listaProizvodaOrdered[i].thumbnailPhoto;

                    s += `<a href="${linkKaDetaljuProizvoda}">
                               <img class="lazy card-img-top" style="height: 250px;" src="${thumbnailPhotoPath}" alt="Slika proizvoda: ${listaProizvodaOrdered[i].naziv}">
                           </a>
                                `;

                    s += `<div class="card-body text-center">
                            <div class="row">
                                <div class="d-flex justify-content-center col-md-12 mb-3 mt-3">
                                `;

                    if(listaProizvodaOrdered[i].popust != 0){
                        s += `    <div style="position: relative; margin-right: 0.8rem;">
                                        <span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #e4ce21;">${listaProizvodaOrdered[i].cena}&#8364;</span>
                                        <i class="fa fa-slash redSlash3"></i>
                                   </div>
                                         `;
                    }
                    if(listaProizvodaOrdered[i].popust == 0){
                        s += `<span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #e4ce21;">${listaProizvodaOrdered[i].cena}&#8364;</span>
                              `;
                    }
                    if(listaProizvodaOrdered[i].popust != 0){
                        let cenaSaPopustom = listaProizvodaOrdered[i].cena * (1 - listaProizvodaOrdered[i].popust/100);
                        cenaSaPopustom = Math.round(cenaSaPopustom);
                        s += `<div>
                                <span class="font-weight-bolder d-block pl-2 pr-2" style="background-color: #1fcb36;">${cenaSaPopustom} &#8364;</span>
                              </div>
                              `;
                    }

                    s+=`        </div>
                                `;

                    s+=`        <div class="d-flex justify-content-center col-md-12">
                                    <a href="/prodavnica/proizvod?proizvodId=${listaProizvodaOrdered[i].proizvodId}" class="text-decoration-none linkTextProdavnicaProizvod">
                                        <div class="card-title nazivProizvodaFrontPage">${listaProizvodaOrdered[i].naziv}</div>
                                    </a>
                                </div>
                                `;

                    //TO-DO: ima na stanju ili nema na stanju deo...
                    s+= `        <div class="d-flex justify-content-center col-md-12">
                                  `;

                    if(listaProizvodaOrdered[i].kolicina > 0){
                    s+= `           <span class="font-weight-bolder" style="color: #1e7e34;"><i class="fas fa-check"></i> Na Stanju</span>
                                    `;
                    }else {
                    s+= `           <span class="font-weight-bolder" style="color: red;"><i class="fas fa-times"></i> Trenutno Nema na Stanju</span>
                                    `;
                    }

                    s+=`         </div>
                                 `;

                    s+=`      </div>
                          </div>
                                `;

                    s+= `</div>
                              `;
                    }
                $('#listaProizvodaWrapper').html(s);
                document.getElementById('showMoreBtn').style.display = 'inline-block';

            }
        });

    });
</script>

</body>
</html>