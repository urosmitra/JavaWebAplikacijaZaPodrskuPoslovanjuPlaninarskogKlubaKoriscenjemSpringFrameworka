<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="sr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <title>Planinarski klub "Summit Explorers"</title>

    <!-- Bootstrap 4.5 CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!-- reference CSS file -->
    <link rel="stylesheet" th:href="@{/css/myStyle.css}">

    <!--Font Awesome ikonice!-->
    <link th:href="@{/fontAwesome/all.css}" rel="stylesheet">
    <!--load all styles -->
</head>
<body>

<!-- Navigation bar fragment -->
<div th:replace="fragments/navBar :: navBar1"></div>
<!-- Navigation bar fragment END-->

<div class="container">



    <div class="col-md-9 ml-0 mt-2">
        <h2>Lista predstojećih Polazaka/Putovanja za Aranžman (ID: [[${aranzman.aranzmanId}]], Naziv: [[${aranzman.naziv}]])</h2>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <a th:href="@{/admin/putovanje/new(aranzmanId=${aranzman.aranzmanId})}" class="btn btn-outline-info">Dodaj Novi Polazak</a>
            <a th:href="@{/admin/putovanje/pregledProslihPutovanja(aranzmanId=${aranzman.aranzmanId})}" class="btn btn-link">Pregled Proteklih putovanja</a>
            <a th:href="@{/admin/putovanje/pregledOtkazanihPutovanja(aranzmanId=${aranzman.aranzmanId})}" class="btn btn-link">Pregled Otkazanih Putovanja</a>
            <a th:href="@{/admin/putovanje/pregledPutovanjaUToku(aranzmanId=${aranzman.aranzmanId})}" class="btn btn-link">Pregled putovanja koje je u toku</a>
        </div>
    </div>

    <!--/* POVRATNE PORUKE */-->
    <th:block th:if="${messageSuccess}">
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${messageSuccess}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </th:block>

    <th:block th:if="${failMessage}">
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${failMessage}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </th:block>
    <!--/* KRAJ POVRATNIH PORUKA */-->

<th:block th:if="${listaPutovanjaAranzmana == null or listaPutovanjaAranzmana.isEmpty()}">
    <h3>Trenutno ne postoji nijedan predstojeći polazak/putovanje za izabrani Aranžman.</h3>
</th:block>
<th:block th:if="${listaPutovanjaAranzmana != null and !listaPutovanjaAranzmana.isEmpty()}">

    <th:block th:with="listaBuducihPutovanja = ${@putovanjeServiceImpl.getAllBuducaPutovanjaAranzmana(aranzman.aranzmanId)}">
        <th:block th:if="${listaBuducihPutovanja != null and !listaBuducihPutovanja.isEmpty()}">
            <div align="center">

                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                    <tr>
                        <th>ID Putovanja</th>
                        <th>Datum/Vreme Polaska</th>
                        <th>Datum Povratka</th>
                        <th>Popust</th>
                        <th>Cena sa popustom (&#8364;)</th>
                        <th>Broj Prijavljenih</th>
                        <th>Rezervacije</th>
                        <th>Status</th>
                        <th>Akcije</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="putovanje : ${listaBuducihPutovanja}">
                        <td th:text="${putovanje.putovanjeId}"></td>
                        <td th:text="${#temporals.format(putovanje.datumVremePolaska, 'dd.MM.yyyy. HH:mm')}"></td>
                        <td th:text="${#temporals.format(putovanje.datumPovratka, 'dd.MM.yyyy.')}"></td>

                        <!--/*Popust th blockovi */-->
                        <th:block th:if="${putovanje.popust == null or putovanje.popust == 0}">
                            <td>NE</td>
                        </th:block>
                        <th:block th:if="${putovanje.popust != null and putovanje.popust != 0}">
                            <td>[[${putovanje.popust}]] %</td>
                        </th:block>
                        <!--/*KRAJ Popust th blockovi */-->


                        <td th:text="${@putovanjeServiceImpl.cenaPutovanjaAranzmana(aranzman.cena, putovanje.popust)} + ' &#8364;'"></td>
                        <td th:text="${putovanje.brojPrijavljenih}"></td>
                        <td><!--Rezervacije -->
                            <a th:href="@{/admin/putovanje/rezervacijePutovanja(putovanjeId=${putovanje.putovanjeId})}" class="btn btn-success">Pregled Rezervacija Putovanja (ID: [[${putovanje.putovanjeId}]])</a>
                        </td>
                        <td th:text="${putovanje.status}"></td>

                        <td> <!--/* Akcije putovanja (Edit i Delete) */-->
                            <a th:href="@{'/admin/putovanje/edit/' + ${putovanje.putovanjeId}}" class="btn btn-warning btn-sm mb-1">Izmeni</a>
                            <a th:href="@{/admin/putovanje/delete(putovanjeId=${putovanje.putovanjeId}, aranzmanId=${aranzman.aranzmanId})}" class="btn btn-danger btn-sm"
                                th:data-putovanjeId="${putovanje.putovanjeId}"
                                onclick="return confirm('Da li ste sigurni da želite da obrišete putovanje kao i sve rezervacije u okviru njega? (Putovanje ID: ' + this.getAttribute('data-putovanjeId') +  ')')">Obriši</a>
                        </td>

                    </tr>
                    </tbody>

                </table>

            </div>


        </th:block>
        <th:block th:if="${listaBuducihPutovanja == null or listaBuducihPutovanja.isEmpty()}">
            <h3>Trenutno ne postoji nijedan predstojeći polazak/putovanje za izabrani Aranžman.</h3>
        </th:block>
    </th:block>

</th:block>


</div>






<!-- Script Source Files -->

<!-- jQuery -->
<script th:src="@{/js/jquery-3.5.1.min.js}"></script>
<!-- Popper JS -->
<script th:src="@{/js/popper.min.js}"></script>
<!-- Bootstrap 4.5 JS -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- Font Awesome -->
<script th:src="@{/js/all.js}"></script>
</body>
</html>