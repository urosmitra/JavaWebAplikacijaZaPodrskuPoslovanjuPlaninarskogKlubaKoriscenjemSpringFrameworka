<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="sr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <title>Planinarski klub "Summit Explorers"</title>

    <!-- Bootstrap 4.5 CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">

    <!-- reference CSS file -->
    <link rel="stylesheet" th:href="@{/css/myStyle.css}">



    <!--load all styles -->
    <!--Font Awesome ikonice!-->
    <link th:href="@{/fontAwesome/all.css}" rel="stylesheet">

</head>
<body>
<!-- Navigation bar fragment -->
<div th:replace="fragments/navBar :: navBar1"></div>
<!-- Navigation bar fragment END-->

<div class="container">
    <div class="col-md-9 ml-0 mt-2 pl-0">
        <h3>Nova Rezervacija za Putovanje (Putovanje ID: [[${putovanje.putovanjeId}]], Naziv Aranžmana: [[${aranzman.naziv}]])</h3>
    </div>

    <p class="lead mb-2">Datumi putovanja: <span style="font-weight: bold;">[[${#temporals.format(putovanje.datumVremePolaska, 'dd.MM.yyyy.')}]]</span> - <span style="font-weight: bold;">[[${#temporals.format(putovanje.datumPovratka, 'dd.MM.yyyy.')}]]</span></p>

    <!--/* POVRATNE PORUKE */-->
    <th:block th:if="${korisnikNePostoji}">
        <div class="alert alert-danger alert-dismissible fade show col-md-7" role="alert">
            <span th:text="${korisnikNePostoji}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </th:block>

    <th:block th:if="${putovanjePopunjeno}">
        <div class="alert alert-danger alert-dismissible fade show col-md-7" role="alert">
            <span><i class="fas fa-exclamation-circle"></i> Nažalost, ovo putovanje je dostiglo <span class="font-weight-bolder">maksimalan broj rezervacija!</span></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </th:block>
    <!--/* KRAJ POVRATNIH PORUKA */-->

    <div class="col-md-7 pl-1">
        <form action="#" th:action="@{/admin/provera-emaila-za-rezervaciju}" method="POST">
            <div class="form-group">
                <label for="emailKorisnika">Email korisnika:</label>
                <input type="email" id="emailKorisnika" name="emailKorisnika" required class="form-control" placeholder="Unesite email korisnika za koga je rezervacija">

                <th:block th:if="${korisnikImaRezervaciju == 'DA'}">
                    <p style="color: red; font-size: 12px;" class="pt-0 mb-1">Korisnik sa unetim email-om već ima rezervaciju za ovo putovanje! (Unet email: <span style="font-weight: bold;">[[${unetEmailKorisnika}]]</span>)</p>
                </th:block>


                <input type="hidden" name="putovanjeId" th:value="${putovanje.putovanjeId}">
                <input type="submit" class="btn btn-outline-primary mt-2" value="Proveri">
                <a th:href="@{/admin/putovanje/rezervacijePutovanja(putovanjeId=${putovanje.putovanjeId})}" class="btn btn-secondary mt-2">Odustani</a>
            </div>

        </form>
    </div>

    <th:block th:if="${korisnikImaRezervaciju == 'NE' and putovanjePopunjeno==null}">
        <div class="col-md-8 pl-1">
            <form action="#" th:action="@{/admin/putovanje/rezervacije/addNew}" th:object="${novaRezervacija}" method="POST">
                <fieldset>
                    <legend>Podaci o Korisniku</legend>
                    <div class="form-group col-md-6 pl-0">
<!--                        <p class="lead">Podaci o Korisniku:</p>-->
                        <label>Korisnik ID: </label>
                        <span style="font-weight: bold;">[[${korisnikRezervacije.korisnikId}]]</span><br>
                        <label for="korisnikImePrezime">Ime i prezime:</label>
                        <input type="text" th:value="${korisnikRezervacije.ime + ' ' + korisnikRezervacije.prezime}" readonly class="form-control mb-2" id="korisnikImePrezime">
                        <label for="korisnikEmail">Email:</label>
                        <input type="text" th:value="${korisnikRezervacije.email}" readonly class="form-control" id="korisnikEmail">
                    </div>
                </fieldset>

                <div class="form-group col-md-6 pl-0">
                    <label for="status">Status Rezervacije:</label>
                    <input type="text" name="status" id="status" class="form-control" readonly th:value="AKTIVNA">
                </div>
                <div class="form-group col-md-6 pl-0" th:with="cenaPutovanja1 = ${@rezervacijaPutovanjeServiceImpl.izracunajCenuPutovanja(putovanje.popust, aranzman.cena)}">
                    <label>Cena Putovanja:</label>
                    <span class="font-weight-bolder">[[${cenaPutovanja1}]]&#8364;</span>
                    <input type="hidden" name="cenaPutovanja" th:value="${cenaPutovanja1}">
                </div>

                <!--HIDDEN POLJA PRENOS ZA REZERVACIJU -->
                <input type="hidden" th:field="*{rezervacijaId}">
                <input type="hidden" name="datumVremeRez" th:value="${#temporals.format(#temporals.createNow(),'yyyy-MM-dd HH:mm:ss')}">
                <input type="hidden" name="korisnik" th:value="${korisnikRezervacije.korisnikId}">
                <input type="hidden" th:name="putovanje" th:value="${putovanje.putovanjeId}">

                <th:block th:if="${#fields.hasErrors('global')}">
                    <h5 style="color: red;">Globalne greške:</h5>
                    <ul>
                        <li th:each="err : ${#fields.errors('global')}" th:text="${err}" class="errorMsg"></li>
                    </ul>
                </th:block>

                <input type="submit" class="btn btn-success" value="Napravi Novu Rezervaciju" name="btnNovaRezervacija">
            </form>
        </div>
    </th:block>

</div>

<!--/* Footer fragment */-->
<div class="container">
    <div th:replace="fragments/footer :: footer1"></div>
</div>
<!--/* Footer fragment END */-->

<!-- Script Source Files -->

<!-- jQuery -->
<script th:src="@{/js/jquery-3.5.1.min.js}"></script>
<!-- Popper JS -->
<script th:src="@{/js/popper.min.js}"></script>
<!-- Bootstrap 4.5 JS -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- Font Awesome -->
<script th:src="@{/js/all.js}"></script>
</body>
</html>